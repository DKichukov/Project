import java.io.*;import java.text.DateFormat;import java.text.ParseException;import java.text.SimpleDateFormat;import java.util.Locale;import java.util.Objects;import java.util.Scanner;import java.util.regex.Matcher;import java.util.regex.Pattern;public class EmployeeVacationProgram {    public static void printTableFormat() {        System.out.print("_________________________________________________________________________________________\n");        System.out.print("| №| ");        System.out.print("     Име:     | ");        System.out.print("     Имейл    | ");        System.out.print("    ID:   |");        System.out.print(" Начало |");        System.out.print("   Край   |");        System.out.print("   Тип   |");        System.out.print("  Статус  | \n");        System.out.print("-----------------------------------------------------------------------------------------\n");    }    public static boolean isValidMailFormat(String email) {        String emailRegex = "^[A-Z\\d._%+-]+@[A-Z\\d.-]+\\.[A-Z]{2,6}$";        Pattern emailPat = Pattern.compile(emailRegex, Pattern.CASE_INSENSITIVE);        Matcher matcher = emailPat.matcher(email);        return matcher.find();    }    public static boolean isDateFormatValid(String date) {        DateFormat df = new SimpleDateFormat("dd.MM.yyyy");        df.setLenient(false);        try {            df.parse(date.trim());        } catch (ParseException pe) {            return false;        }        return true;    }    public static boolean isIdNumberTenDigits(String num) {        return num.length() == 10;    }    public static boolean checkHolidayType(String text) {        return Objects.equals(text.toLowerCase(), "платена") || Objects.equals(text.toLowerCase(), "неплатена");    }    public static boolean checkName(String[][] tableNames, String enteredName) {        String checkName = "";        for (int i = 0; i < readCsvFile(); i++) {            if(enteredName.equalsIgnoreCase(tableNames[i][1])){                return true;            }        }        return false;    }    public static boolean checkStatus(String statusInput) {        return Objects.equals(statusInput.toLowerCase(), "одобрена") || Objects.equals(statusInput.toLowerCase(),                "отказана")||Objects.equals(statusInput.toLowerCase(),                "чакаща");    }        public static int readCsvFile () {            int lnCounter = 0;            String rowNum = "";            try {                BufferedReader br = new BufferedReader(new FileReader("database.csv"));                while ((rowNum = br.readLine()) != null) {                    lnCounter++;                    if (rowNum.trim().isEmpty()) {                        lnCounter--;                        break;                    }                }                br.close();            } catch (IOException e) {                System.out.print("CSV data file read error!");                e.printStackTrace();            }            return lnCounter;        }        public static void copyCsvFileToArray (String[][]dataFile) throws IOException {            int lnCount = 0;            String line = "";            BufferedReader br = new BufferedReader(new FileReader("database.csv"));            line.trim().isEmpty();            while ((line = br.readLine()) != null) {                lnCount++;                if (line.trim().isEmpty()) {                    lnCount--;                    break;                }                String[] data = (line.split(","));                for (int comaCounter = 0; comaCounter < dataFile[0].length; comaCounter++) {                    dataFile[lnCount - 1][comaCounter] = data[comaCounter] + "";                }            }            br.close();        }        public static void saveDataToCSVFile (String[]data){            try {                FileWriter fw = new FileWriter("database.csv", true);                BufferedWriter bw = new BufferedWriter(fw);                bw.newLine();                for (String tempData : data) {                    bw.write(tempData + ",");                }                bw.close();            } catch (IOException e) {                System.out.println("Проблем със записване на данните!");                e.printStackTrace();            }        }        public static void saveChangesToCSVFile (String[][]table){            //String line = "";            try {                FileWriter fw = new FileWriter("database.csv", false);                BufferedWriter bw = new BufferedWriter(fw);                for (int i = 0; i < table.length; i++) {                    for (int j = 0; j < table[0].length; j++) {                        if (table[i][j] != null) {                            bw.write(table[i][j] + ",");                        }                    }                    bw.newLine();                }                bw.close();            } catch (IOException e) {                System.out.println("File saving error!");                e.printStackTrace();            }        }        public static void main (String[]args) throws IOException {            Scanner sc = new Scanner(System.in);            int count = readCsvFile();            String[][] table = new String[20][8];            int ch;            copyCsvFileToArray(table);            do {                System.out.println("***  Система за отпуски  ***");                System.out.println("---------------------------------------");                System.out.println("   1. Заяви отпуска");                System.out.println("   2. Виж всички отпуски");                System.out.println("   3. Виж отпуска за служител");                System.out.println("   4. Промени статус на отпуска");                System.out.println("   5. Иход");                System.out.println("---------------------------------------");                System.out.println("count is ->" + count);                System.out.print("    Въведи избор:");                ch = sc.nextInt();                switch (ch) {                    case 1 -> {                        String loopEnd;                        do {                            table[count][0] = String.valueOf(1 + count);                            System.out.print("Въведи име: ");                            sc.nextLine();                            table[count][1] = sc.nextLine();                            do {                                System.out.print("Въведи имейл: ");                                table[count][2] = sc.next();                                System.out.print(isValidMailFormat(table[count][2]) ? "" : " Въвели сте грешен мейл. Опитайте " +                                        "отново!\n");                            } while (!isValidMailFormat(table[count][2]));                            do {                                System.out.print("Въведи ЕГН (десет цифри):");                                table[count][3] = sc.next();                                System.out.print(isIdNumberTenDigits(table[count][3]) ? "" : " Въвели сте грешно ЕГН. " +                                        "Опитайте отново!\n");                            } while (table[count][3].length() != 10);                            do {                                System.out.print("Въведи начална дата на отпуската (формат:дд.мм.гггг): ");                                table[count][4] = sc.next();                                System.out.print(isDateFormatValid(table[count][4]) ? "" : "Въвели сте грешен формат за" +                                        " дата. Опитайте отново!\n");                            } while (!isDateFormatValid(table[count][4]));                            do {                                System.out.print("Въведи крайна дата на отпуската (формат:дд.мм.гггг): ");                                table[count][5] = sc.next();                                System.out.print(isDateFormatValid(table[count][5]) ? "" : "Въвели сте грешен формат за" +                                        " дата. Опитайте отново!\n");                            } while (!isDateFormatValid(table[count][5]));                            do {                                System.out.print("Въведи тип на отпуска планена или неплатена ):");                                table[count][6] = sc.next();                                System.out.print(checkHolidayType(table[count][6]) ? "" : "Въведен е грешен тип. " +                                        "Опитайте отново!\n");                            } while (!checkHolidayType(table[count][6]));                            do {                                System.out.print("Въведете статус: одобрена/отказана/чакаща ):");                                table[count][7] = sc.next();                                System.out.print(checkHolidayType(table[count][6]) ? "" : "Въведен е грешен статус. " +                                        "Опитайте отново!\n");                            } while (!checkStatus(table[count][7]));                            System.out.println("Ако искате да въведете друг запис, въведете 'Да'.");                            loopEnd = sc.next();                            saveDataToCSVFile(table[count]);                            count++;                        } while (loopEnd.equals("да"));                    }                    case 2 -> {                        printTableFormat();                        for (int i = 0; i < count; i++) {                            for (int j = 0; j < table[0].length; j++) {                                System.out.print("| " + table[i][j]);                            }                            System.out.println(" |\n"+"-----------------------------------------------------------------------------------------");                        }                    }                    case 3 -> {                        String[][] buffer = new String[table.length][table[0].length];                        sc.nextLine();                        System.out.println("Въведи име на служител:");                        String enteredName = sc.nextLine();                        if (checkName(table, enteredName)) {                            printTableFormat();                        for (int i = 0; i <= count; i++) {                            if (enteredName.equalsIgnoreCase(table[i][1])) {                                for (int j = 0; j < table[0].length; j++) {                                    buffer[i][j] = table[i][j];                                    System.out.print("| " + buffer[i][j]);                                }                                System.out.println(" |");                            }                        }                        } else {                            System.out.println("Няма сложител с това име!");                        }                        System.out.print("-----------------------------------------------------------------------------------------\n");                    }                    case 4 -> {                        System.out.println("Изберете номер на заявка: ");                        int numRequest = sc.nextInt() - 1;                        printTableFormat();                        for (int j = 0; j < table[0].length; j++) {                            System.out.print("| " + table[numRequest][j]);                        }                        System.out.println(" |\n" +                                        "-----------------------------------------------------------------------------------------");                        System.out.println("Въведи нов статус за избраната заявка:");                        String newStat = sc.next();                        table[numRequest][7] = newStat;                        for (int j = 0; j < table[0].length; j++) {                            System.out.print("| " + table[numRequest][j]);                        }                        System.out.println(" |\n"+                                "-----------------------------------------------------------------------------------------");                        saveChangesToCSVFile(table);                    }                    case 5 -> System.out.println("Край на програмата!");                    default -> System.out.println("Въвели сте грешен избор!!!");                }            } while (ch != 5);        }    }